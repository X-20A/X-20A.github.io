import{d as e,u as n,c as a,a as i,o as s,b as t,e as u,F as l,r as o,aH as c,n as d,w as v,f as r,aI as _,aJ as p,aK as f,_ as m}from"./index-CUClNGzv.js";const A={class:"evacuation-list"},h={class:"ship-list"},E=["onPointerdown"],b=["src","alt","title"],C=m(e({__name:"CommandEvacuation",setup(e){const m=n(),C=a((()=>m.cxtTapedNode)),N=a((()=>m.adoptFleet)),x=a((()=>m.commandEvacuations)),O=i(),D=a((()=>O.isCommandEvacuationVisible)),T=a((()=>N.value?N.value.fleets.map((e=>({ships:e.units.map((e=>{const{ship:n}=e;return{id:n.id,unit_index:e.unit_index,name:n.name}}))}))):[])),M=a((()=>x.value.find((e=>e.node===C.value))));function U(e,n){var a;return!!M.value&&((null==(a=M.value.evacuation_ship_unique_ids[e])?void 0:a.includes(n))??!1)}function I(){const e=x.value.filter((e=>e.node!==C.value));m.UPDATE_COMMAND_EVACUATIONS(e)}let P=!0;return window.addEventListener("contextmenu",(e=>{D.value&&P&&(e.preventDefault(),P=!1)})),(e,n)=>D.value?(s(),t("div",{key:0,class:"evacuation-modal",onPointerdown:n[0]||(n[0]=v((()=>{}),["stop"]))},[n[1]||(n[1]=u("div",{class:"fleet-title"},"司令退避する艦を選択",-1)),u("div",A,[(s(!0),t(l,null,o(T.value,((e,n)=>(s(),t("div",{key:n,class:"fleet-block"},[u("div",h,[(s(!0),t(l,null,o(e.ships,((e,a)=>{return s(),t("div",{key:e.unit_index,class:c(["ship-item",{evacuated:U(n,e.unit_index),flagship:0===a}]),style:d(0===a?"cursor: default;":""),onPointerdown:i=>0!==a&&function(e,n){if(!C.value)return;if(0===n)return;const a=C.value,i=x.value,s=i.findIndex((e=>e.node===a));if(-1===s){const s={};s[e]=[n];const t={node:f(a),evacuation_ship_unique_ids:s};return void m.UPDATE_COMMAND_EVACUATIONS(_(i,t))}const t=i[s],u={};for(const o of Object.keys(t.evacuation_ship_unique_ids))u[Number(o)]=[...t.evacuation_ship_unique_ids[Number(o)]];const l=u[e]||[];l.includes(n)?u[e]=l.filter((e=>e!==n)):u[e]=[...l,n],Object.values(u).every((e=>0===e.length))?m.UPDATE_COMMAND_EVACUATIONS(p(i,a)):m.UPDATE_COMMAND_EVACUATIONS([...i.slice(0,s),{...t,evacuation_ship_unique_ids:u},...i.slice(s+1)])}(n,e.unit_index)},[u("img",{class:"ship-icon",src:(i=e.id,`./banners/${i}.png`),alt:e.name,title:e.name},null,8,b)],46,E);var i})),128))])])))),128))]),u("button",{class:"design-button clear-btn",onClick:I}," 一括解除 ")],32)):r("",!0)}}),[["__scopeId","data-v-5c472f16"]]);export{C as default};
