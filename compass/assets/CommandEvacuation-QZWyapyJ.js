import{d as e,u as a,c as n,aB as i,e as s,f as t,g as u,F as l,m as o,aG as c,aH as d,aD as v,k as r,aI as _,aJ as p,aK as f,p as m}from"./index-CTSNR4zq.js";const A={class:"evacuation-list"},h={class:"ship-list"},E=["onPointerdown"],C=["src","alt","title"],N=m(e({__name:"CommandEvacuation",setup(e){const m=a(),N=n((()=>m.cxtTapedNode)),b=n((()=>m.adoptFleet)),x=n((()=>m.commandEvacuations)),D=i(),O=n((()=>D.isCommandEvacuationVisible)),T=n((()=>b.value?b.value.fleets.map((e=>({ships:e.units.map((e=>{const{ship:a}=e;return{id:a.id,unit_index:e.unit_index,name:a.name}}))}))):[])),M=n((()=>x.value.find((e=>e.node===N.value))));function U(e,a){var n;return!!M.value&&((null==(n=M.value.evacuation_ship_unique_ids[e])?void 0:n.includes(a))??!1)}function k(){const e=x.value.filter((e=>e.node!==N.value));m.UPDATE_COMMAND_EVACUATIONS(e)}let I=!0;return window.addEventListener("contextmenu",(e=>{O.value&&I&&(e.preventDefault(),I=!1)})),(e,a)=>O.value?(s(),t("div",{key:0,class:"evacuation-modal",onPointerdown:a[0]||(a[0]=v((()=>{}),["stop"]))},[a[1]||(a[1]=u("div",{class:"fleet-title"},"司令退避する艦を選択",-1)),u("div",A,[(s(!0),t(l,null,o(T.value,((e,a)=>(s(),t("div",{key:a,class:"fleet-block"},[u("div",h,[(s(!0),t(l,null,o(e.ships,((e,n)=>{return s(),t("div",{key:e.unit_index,class:c(["ship-item",{evacuated:U(a,e.unit_index),flagship:0===n}]),style:d(0===n?"cursor: default;":""),onPointerdown:i=>0!==n&&function(e,a){if(!N.value)return;if(0===a)return;const n=N.value,i=x.value,s=i.findIndex((e=>e.node===n));if(-1===s){const s={};s[e]=[a];const t={node:f(n),evacuation_ship_unique_ids:s};return void m.UPDATE_COMMAND_EVACUATIONS(_(i,t))}const t=i[s],u={};for(const o of Object.keys(t.evacuation_ship_unique_ids))u[Number(o)]=[...t.evacuation_ship_unique_ids[Number(o)]];const l=u[e]||[];l.includes(a)?u[e]=l.filter((e=>e!==a)):u[e]=[...l,a],Object.values(u).every((e=>0===e.length))?m.UPDATE_COMMAND_EVACUATIONS(p(i,n)):m.UPDATE_COMMAND_EVACUATIONS([...i.slice(0,s),{...t,evacuation_ship_unique_ids:u},...i.slice(s+1)])}(a,e.unit_index)},[u("img",{class:"ship-icon",src:(i=e.id,`./banners/${i}.png`),alt:e.name,title:e.name},null,8,C)],46,E);var i})),128))])])))),128))]),u("button",{class:"design-button clear-btn",onClick:k}," 一括解除 ")],32)):r("",!0)}}),[["__scopeId","data-v-5c472f16"]]);export{N as default};
